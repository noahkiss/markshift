---
phase: 03-markdown-to-html
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/converters/markdown-to-html/index.ts
  - src/index.ts
  - tests/converters/markdown-to-html.test.ts
autonomous: true

must_haves:
  truths:
    - "User can convert Markdown to valid HTML"
    - "Round-trip conversion (HTML->MD->HTML) preserves semantic meaning"
    - "GFM syntax (tables, strikethrough, task lists) converts to HTML"
    - "Output HTML uses language-* class prefix on code blocks"
  artifacts:
    - path: "src/converters/markdown-to-html/index.ts"
      provides: "MarkdownToHtmlConverter class"
      exports: ["MarkdownToHtmlConverter"]
      min_lines: 25
    - path: "tests/converters/markdown-to-html.test.ts"
      provides: "Test suite for Markdown to HTML conversion"
      min_lines: 50
  key_links:
    - from: "src/converters/markdown-to-html/index.ts"
      to: "marked"
      via: "import { marked } from 'marked'"
      pattern: "import.*marked.*from.*marked"
    - from: "src/converters/markdown-to-html/index.ts"
      to: "Converter interface"
      via: "implements Converter"
      pattern: "implements Converter"
    - from: "src/index.ts"
      to: "src/converters/markdown-to-html/index.ts"
      via: "export statement"
      pattern: "export.*MarkdownToHtmlConverter"
---

<objective>
Implement MarkdownToHtmlConverter using marked library with GFM support

Purpose: Enable bidirectional HTML/Markdown conversion - the core value proposition of text-transform. Users need to convert LLM output (Markdown) to HTML for pasting into Teams, email, and other platforms.

Output: MarkdownToHtmlConverter class registered in exports, comprehensive test suite including round-trip semantic verification
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-markdown-to-html/03-RESEARCH.md

# Existing patterns to follow
@src/converters/index.ts
@src/converters/html-to-markdown/index.ts
@src/index.ts
@tests/converters/html-to-markdown.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install marked and implement MarkdownToHtmlConverter</name>
  <files>
    package.json
    src/converters/markdown-to-html/index.ts
  </files>
  <action>
Install marked v17.x:
```bash
npm install marked
```

No @types/marked needed - marked ships with built-in TypeScript definitions.

Create `src/converters/markdown-to-html/index.ts` implementing Converter interface:

1. Import `marked` from 'marked'
2. Import Converter interface and types following html-to-markdown pattern
3. Create MarkdownToHtmlConverter class:
   - `sourceFormat: Format = 'markdown'`
   - `targetFormat: Format = 'html'`
   - Constructor configures marked with:
     - `gfm: true` (tables, strikethrough, task lists)
     - `breaks: false` (don't convert \n to <br>)
   - `convert(input, options?)` method:
     - Use `marked.parse(input) as string` (synchronous mode)
     - Track processingTimeMs with performance.now()
     - Return ConvertResult with content and metadata

Key patterns from RESEARCH.md:
- Use `marked.use({ gfm: true, breaks: false })` in constructor
- Cast result: `marked.parse(markdown) as string` (avoid async type confusion)
- marked uses `language-` prefix for code blocks by default (matches Phase 2 extraction)

Do NOT add sanitization (DOMPurify) - this is an internal tool, not user-input processing.
  </action>
  <verify>
```bash
npx tsc --noEmit
npm test -- --run
```
TypeScript compiles without errors. Existing tests still pass.
  </verify>
  <done>
- marked is in dependencies (check package.json)
- MarkdownToHtmlConverter exists at src/converters/markdown-to-html/index.ts
- Class implements Converter interface
- TypeScript compiles cleanly
  </done>
</task>

<task type="auto">
  <name>Task 2: Export converter and create comprehensive test suite</name>
  <files>
    src/index.ts
    tests/converters/markdown-to-html.test.ts
  </files>
  <action>
**Update src/index.ts:**
Add export for MarkdownToHtmlConverter following existing pattern:
```typescript
export { MarkdownToHtmlConverter } from './converters/markdown-to-html/index.js';
```

**Create tests/converters/markdown-to-html.test.ts:**

Test suite covering CONV-06 requirement and success criteria:

1. **Basic conversion tests:**
   - Headings (# H1, ## H2, etc.) -> `<h1>`, `<h2>`
   - Paragraphs -> `<p>`
   - Bold/italic (**bold**, *italic*, _italic_) -> `<strong>`, `<em>`
   - Links [text](url) -> `<a href="url">`
   - Images ![alt](src) -> `<img>`

2. **GFM feature tests:**
   - Tables (|header|) -> `<table>` with thead/tbody
   - Strikethrough (~~text~~) -> `<del>` or `<s>`
   - Task lists (- [x], - [ ]) -> checkboxes
   - Fenced code blocks with language -> `<pre><code class="language-X">`

3. **Code block tests:**
   - Fenced blocks (```) -> `<pre><code>`
   - Language hint preserved (```javascript) -> `class="language-javascript"`
   - Inline code (`code`) -> `<code>`

4. **List tests:**
   - Unordered lists (- item) -> `<ul><li>`
   - Ordered lists (1. item) -> `<ol><li>`
   - Nested lists -> proper nesting

5. **Round-trip semantic tests:**
   - HTML -> MD (Phase 2) -> HTML (Phase 3) preserves:
     - Headings
     - Bold/italic
     - Links
     - Lists
     - Code blocks
   - Note: Structure may differ but semantic meaning preserved

6. **Metadata tests:**
   - Result contains sourceFormat: 'markdown'
   - Result contains targetFormat: 'html'
   - Result contains processingTimeMs >= 0

Follow test patterns from html-to-markdown.test.ts:
- Use describe/it structure
- Test edge cases (empty input, whitespace-only)
- Use flexible assertions where appropriate (marked may add extra whitespace/newlines)
  </action>
  <verify>
```bash
npm test -- --run
```
All tests pass including new markdown-to-html tests.
  </verify>
  <done>
- MarkdownToHtmlConverter exported from src/index.ts
- Test file exists at tests/converters/markdown-to-html.test.ts
- Tests cover: basic elements, GFM features, code blocks, lists, round-trip semantics
- All tests pass
  </done>
</task>

</tasks>

<verification>
Overall verification after all tasks:

```bash
# Full test suite passes
npm test -- --run

# TypeScript compiles
npm run build

# Verify exports
node -e "import('markshift').then(m => console.log('Exports:', Object.keys(m).filter(k => k.includes('Converter'))))"
```

Expected output includes both `HtmlToMarkdownConverter` and `MarkdownToHtmlConverter`.
</verification>

<success_criteria>
1. MarkdownToHtmlConverter converts Markdown headings, paragraphs, links, images, lists to valid HTML
2. GFM tables, strikethrough, and task lists convert correctly
3. Code blocks include language class (language-X)
4. Round-trip conversion (HTML->MD->HTML) preserves semantic meaning (headings, links, emphasis, lists)
5. All existing tests continue to pass
6. New tests comprehensively cover CONV-06 requirement
7. Converter exported from main index.ts
</success_criteria>

<output>
After completion, create `.planning/phases/03-markdown-to-html/03-01-SUMMARY.md` using the summary template.

Include:
- Duration and task completion
- Files created/modified
- Any deviations or decisions made
- Test coverage summary
- Confirmation of round-trip semantic preservation
</output>
